I"’³<p>
<!--

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<style>
    .share-box a {
  display: inline-block;
  -webkit-box-shadow: 0 0 1px #777;
  box-shadow: 0 0 1px #777;
  padding: 5px 12px;
  margin-right: 5px;
  margin-bottom: 5px;
  text-decoration: none; }
  .share-box a:hover {
    text-decoration: none;
    -webkit-transition: background-color 200ms linear;
    -ms-transition: background-color 200ms linear;
    transition: background-color 200ms linear; }

.f {
  color: #3b5998; }
  .f:hover {
    color: #fff;
    background-color: #3b5998; }

.t {
  color: #4099FF; }
  .t:hover {
    color: #fff;
    background-color: #4099FF; }

.g {
  color: #d34836; }
  .g:hover {
    color: #fff;
    background-color: #d34836; }

.r {
  color: #ff5700; }
  .r:hover {
    color: #fff;
    background-color: #ff5700; }

.l {
  color: #0077b5; }
  .l:hover {
    color: #fff;
    background-color: #0077b5; }

.e {
  color: #444444; }
  .e:hover {
    color: #fff;
    background-color: #444444; }
</style>

<div class="share-box">
<a class="f" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/blog/tsne.html" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fab fa-facebook-f"></i></a>

<a class="t" href="https://twitter.com/intent/tweet?text=&url=http://localhost:4000/blog/tsne.html" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fab fa-twitter"></i></a>

  <a class="g" href="https://plus.google.com/share?url=http://localhost:4000/blog/tsne.html" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fab fa-google-plus-square"></i></a>


<a class="r" href="http://www.reddit.com/submit?url=http://localhost:4000/blog/tsne.html" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" ><i class="fab fa-reddit"></i></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/blog/tsne.html" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fab fa-linkedin-in"></i></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/blog/tsne.html"><i class="fas fa-envelope-square"></i></a>
-->

  <!--
    <a href="https://twitter.com/renbedre?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @renbedre</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
-->

<!--
</div>

-->

</p>

<h2 id="what-is-t-sne"><span style="color:#33a8ff">What is t-SNE?</span></h2>

<ul>
  <li>t-SNE (t-Distributed Stochastic Neighbor Embedding) is nonlinear dimensionality reduction technique in which
interrelated high dimensional data (usually hundreds or thousands of variables) is mapped into low-dimensional data
(like 2 or 3 variables) while preserving the significant structure (relationship among the data points in
different variables) of original high dimensional  data.</li>
  <li>The resulting reduced 2 or 3-dimensional data represents the structure of high dimensional data and easy to
visualize on the scatter plot. The proximal samples will be placed together and dissimilar samples at greater distances.
t-SNE is mostly used for the visualization purposes only and not for detailed quantitative analysis.</li>
</ul>

<!--
- The reduced low-dimensional data will help to identify the significant variables and remove the noise in the data. This
  will further help in downstream analysis to cluster the more relevant data. For example, gene with similar expression responses in particular
  tissue or time points in RNA-seq, cell clustering in scRNA-seq etc.
- For example, in gene expression analysis by RNA-seq, we study the expression differences among multiple conditions and
  it is necessary to use dimensionality reduction techniques to visualize the clusters to identify the
  gene expression differences among different experimental conditions. Similarly, in single cell RNA-seq (scRNA-seq) t-SNE
  is useful to visualize expression pattern in thousand to millions of individual cells.
-->

<ul>
  <li>For example, t-SNE is more suitable for single cell RNA-seq (scRNA-seq) as it produces the expression data for various cell 
classes which encompasses a biologically meaningful hierarchical structure.</li>
  <li>Unlike PCA, t-SNE can be applied and work better with both linear and nonlinear well-clustered datasets and produces 
more meaningful clustering</li>
</ul>

<h2 id="t-sne-in-python"><span style="color:#33a8ff">t-SNE in Python</span></h2>
<ul>
  <li>To run t-SNE in Python, we will use the <code class="language-plaintext highlighter-rouge">digits</code> dataset which is available in the <code class="language-plaintext highlighter-rouge">scikit-learn</code> package. I have a
also used scRNA-seq data for t-SNE visualization (see below).</li>
  <li>The <code class="language-plaintext highlighter-rouge">digits</code> dataset (representing an image of a digit) has 64 variables (D) and 1797 observations (N) divided into 
10 different categories of digits</li>
  <li>we will use sklearn and bioinfokit (v0.8.5 or later) packages for t-SNE and visualization</li>
  <li>Check <a href="http://localhost:4000/blog/howtoinstall.html">bioinfokit documentation</a> for installation and documentation</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># you can use interactive python interpreter, jupyter notebook, spyder or python code
# I am using interactive python interpreter (Python 3.7)
# import pandas dataframe formatted digits dataset for t-SNE analysis 
# (dataset available at scikit-learn)
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">bioinfokit.analys</span> <span class="kn">import</span> <span class="n">get_data</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="s">'digits'</span><span class="p">).</span><span class="n">data</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
   <span class="n">pixel_0_0</span>  <span class="n">pixel_0_1</span>  <span class="n">pixel_0_2</span>  <span class="n">pixel_0_3</span>  <span class="n">pixel_0_4</span>  <span class="p">...</span>  <span class="n">pixel_7_4</span>  <span class="n">pixel_7_5</span>  <span class="n">pixel_7_6</span>  <span class="n">pixel_7_7</span>  <span class="k">class</span>
<span class="err">0        0.0        0.0        5.0       13.0        9.0  ...       10.0        0.0        0.0        0.0      0
1        0.0        0.0        0.0       12.0       13.0  ...       16.0       10.0        0.0        0.0      1
2        0.0        0.0        0.0        4.0       15.0  ...       11.0       16.0        9.0        0.0      2
3        0.0        0.0        7.0       15.0       13.0  ...       13.0        9.0        0.0        0.0      3
4        0.0        0.0        0.0        1.0       11.0  ...       16.0        4.0        0.0        0.0      4

&gt;&gt;&gt; </span><span class="nc">df</span><span class="p">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">1797</span><span class="p">,</span> <span class="mi">65</span><span class="p">)</span>

<span class="c1"># run t-SNE
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="c1"># perplexity parameter can be changed based on the input datatset
# dataset with larger number of variables requires larger perplexity
# set this value between 5 and 50 (sklearn documentation)
# verbose=1 displays run time messages
# set n_ite sufficiently high to resolve the well stabilized cluster
# get embeddings
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tsne_em</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computing</span> <span class="mi">91</span> <span class="n">nearest</span> <span class="n">neighbors</span><span class="p">...</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Indexed</span> <span class="mi">1797</span> <span class="n">samples</span> <span class="ow">in</span> <span class="mf">0.040</span><span class="n">s</span><span class="p">...</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computed</span> <span class="n">neighbors</span> <span class="k">for</span> <span class="mi">1797</span> <span class="n">samples</span> <span class="ow">in</span> <span class="mf">0.447</span><span class="n">s</span><span class="p">...</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computed</span> <span class="n">conditional</span> <span class="n">probabilities</span> <span class="k">for</span> <span class="n">sample</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">1797</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computed</span> <span class="n">conditional</span> <span class="n">probabilities</span> <span class="k">for</span> <span class="n">sample</span> <span class="mi">1797</span> <span class="o">/</span> <span class="mi">1797</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Mean</span> <span class="n">sigma</span><span class="p">:</span> <span class="mf">8.132731</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">KL</span> <span class="n">divergence</span> <span class="n">after</span> <span class="mi">250</span> <span class="n">iterations</span> <span class="k">with</span> <span class="n">early</span> <span class="n">exaggeration</span><span class="p">:</span> <span class="mf">61.424686</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">KL</span> <span class="n">divergence</span> <span class="n">after</span> <span class="mi">1000</span> <span class="n">iterations</span><span class="p">:</span> <span class="mf">0.736327</span>

<span class="c1"># plot t-SNE clusters
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">bioinfokit.visuz</span> <span class="kn">import</span> <span class="n">cluster</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cluster</span><span class="p">.</span><span class="n">tsneplot</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">tsne_em</span><span class="p">)</span>
<span class="c1"># plot will be saved in same directory (tsne_2d.png) 
</span></code></pre></div></div>
<p>Generated t-SNE plot,</p>
<p align="center">
<img src="/assets/posts/tsne/tsne_2d_1.svg" width="600" />
</p>

<p>Add colors to the cluster,</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get a list of categories
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">color_class</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'class'</span><span class="p">].</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cluster</span><span class="p">.</span><span class="n">tsneplot</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">tsne_score</span><span class="p">,</span> <span class="n">colorlist</span><span class="o">=</span><span class="n">color_class</span><span class="p">,</span> <span class="n">legendpos</span><span class="o">=</span><span class="s">'upper right'</span><span class="p">,</span> <span class="n">legendanchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
</code></pre></div></div>
<p>Generated t-SNE plot,</p>
<p align="center">
<img src="/assets/posts/tsne/tsne_2d_2.svg" width="600" />
</p>

<p>Add customized colors to the cluster,</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get a list of categories
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">color_class</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'class'</span><span class="p">].</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cluster</span><span class="p">.</span><span class="n">tsneplot</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">tsne_score</span><span class="p">,</span> <span class="n">colorlist</span><span class="o">=</span><span class="n">color_class</span><span class="p">,</span> <span class="n">colordot</span><span class="o">=</span><span class="p">(</span><span class="s">'#713e5a'</span><span class="p">,</span> <span class="s">'#63a375'</span><span class="p">,</span> <span class="s">'#edc79b'</span><span class="p">,</span> <span class="s">'#d57a66'</span><span class="p">,</span> <span class="s">'#ca6680'</span><span class="p">,</span> <span class="s">'#395B50'</span><span class="p">,</span> <span class="s">'#92AFD7'</span><span class="p">,</span> <span class="s">'#b0413e'</span><span class="p">,</span> <span class="s">'#4381c1'</span><span class="p">,</span> <span class="s">'#736ced'</span><span class="p">),</span> 
    <span class="n">legendpos</span><span class="o">=</span><span class="s">'upper right'</span><span class="p">,</span> <span class="n">legendanchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
</code></pre></div></div>
<p>Generated t-SNE plot,</p>
<p align="center">
<img src="/assets/posts/tsne/tsne_2d_3.svg" width="600" />
</p>

<h2 id="t-sne-with-single-cell-rna-seq-dataset"><span style="color:#33a8ff">t-SNE with single cell RNA-seq dataset</span></h2>
<ul>
  <li>I have downloaded the subset of single cell gene expression dataset of <i>Arabidopsis thaliana</i> root cells 
processed by 10X genomics Cell Ranger pipeline (Ryu et al., 2019)</li>
  <li>This scRNA-seq dataset contains 4406 cells with ~75K reads per cells</li>
  <li>I have preprocessed this data (for expression cut-off, sequence depth normalization, log-transformation, and molecular feature selection)
using <a href="https://satijalab.org/seurat/v3.1/pbmc3k_tutorial.html" targte="_blank"> Seurat R package</a> and 
exported highly variable molecular features for t-SNE visualization.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># import scRNA-seq as pandas dataframe
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">bioinfokit.analys</span> <span class="kn">import</span> <span class="n">get_data</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="s">'ath_root'</span><span class="p">).</span><span class="n">data</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dft</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">T</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dft</span> <span class="o">=</span> <span class="n">dft</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dft</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dft</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">gene</span>                <span class="n">AT1G01070</span>  <span class="n">RPP1A</span>  <span class="n">HTR12</span>  <span class="n">AT1G01453</span>  <span class="n">ADF10</span>  <span class="n">PLIM2B</span>  <span class="n">SBTI1</span><span class="p">.</span><span class="mi">1</span>  <span class="n">GL22</span>  <span class="n">GPAT2</span>  <span class="n">AT1G02570</span>  <span class="n">BXL2</span>  <span class="n">IMPA6</span>  <span class="p">...</span>  <span class="n">PER72</span>  <span class="n">RAB18</span>  <span class="n">AT5G66440</span>  <span class="n">AT5G66580</span>  <span class="n">AT5G66590</span>  <span class="n">AT5G66800</span>  <span class="n">AT5G66815</span>  <span class="n">AT5G66860</span>  <span class="n">AT5G66985</span>  <span class="n">IRX14H</span>  <span class="n">PER73</span>  <span class="n">RPL26B</span>
<span class="n">AAACCTGAGACAGACC</span><span class="o">-</span><span class="mi">1</span>       <span class="mf">0.51</span>   <span class="mf">1.40</span>  <span class="o">-</span><span class="mf">0.26</span>      <span class="o">-</span><span class="mf">0.28</span>  <span class="o">-</span><span class="mf">0.24</span>   <span class="o">-</span><span class="mf">0.14</span>    <span class="o">-</span><span class="mf">0.13</span> <span class="o">-</span><span class="mf">0.07</span>  <span class="o">-</span><span class="mf">0.29</span>      <span class="o">-</span><span class="mf">0.31</span> <span class="o">-</span><span class="mf">0.23</span>   <span class="mf">0.66</span>  <span class="p">...</span>  <span class="o">-</span><span class="mf">0.25</span>   <span class="mf">0.64</span>       <span class="mf">0.61</span>      <span class="o">-</span><span class="mf">0.55</span>      <span class="o">-</span><span class="mf">0.41</span>      <span class="o">-</span><span class="mf">0.43</span>       <span class="mf">2.01</span>       <span class="mf">3.01</span>      <span class="o">-</span><span class="mf">0.24</span>   <span class="o">-</span><span class="mf">0.18</span>  <span class="o">-</span><span class="mf">0.34</span>    <span class="mf">1.16</span>
<span class="n">AAACCTGAGATCCGAG</span><span class="o">-</span><span class="mi">1</span>      <span class="o">-</span><span class="mf">0.22</span>   <span class="mf">1.36</span>  <span class="o">-</span><span class="mf">0.26</span>      <span class="o">-</span><span class="mf">0.28</span>  <span class="o">-</span><span class="mf">0.60</span>   <span class="o">-</span><span class="mf">0.51</span>    <span class="o">-</span><span class="mf">0.13</span> <span class="o">-</span><span class="mf">0.07</span>  <span class="o">-</span><span class="mf">0.29</span>      <span class="o">-</span><span class="mf">0.31</span>  <span class="mf">0.81</span>  <span class="o">-</span><span class="mf">0.31</span>  <span class="p">...</span>  <span class="o">-</span><span class="mf">0.25</span>   <span class="mf">1.25</span>      <span class="o">-</span><span class="mf">0.48</span>      <span class="o">-</span><span class="mf">0.55</span>      <span class="o">-</span><span class="mf">0.41</span>      <span class="o">-</span><span class="mf">0.43</span>      <span class="o">-</span><span class="mf">0.24</span>       <span class="mf">0.89</span>      <span class="o">-</span><span class="mf">0.24</span>   <span class="o">-</span><span class="mf">0.18</span>  <span class="o">-</span><span class="mf">0.49</span>   <span class="o">-</span><span class="mf">0.68</span>
<span class="n">AAACCTGAGTGTGAAT</span><span class="o">-</span><span class="mi">1</span>      <span class="o">-</span><span class="mf">0.22</span>   <span class="mf">2.49</span>  <span class="o">-</span><span class="mf">0.26</span>      <span class="o">-</span><span class="mf">0.28</span>  <span class="o">-</span><span class="mf">0.60</span>   <span class="o">-</span><span class="mf">0.51</span>    <span class="o">-</span><span class="mf">0.13</span> <span class="o">-</span><span class="mf">0.07</span>  <span class="o">-</span><span class="mf">0.29</span>      <span class="o">-</span><span class="mf">0.31</span> <span class="o">-</span><span class="mf">0.23</span>   <span class="mf">0.99</span>  <span class="p">...</span>  <span class="o">-</span><span class="mf">0.25</span>  <span class="o">-</span><span class="mf">0.52</span>      <span class="o">-</span><span class="mf">0.48</span>      <span class="o">-</span><span class="mf">0.55</span>       <span class="mf">2.92</span>      <span class="o">-</span><span class="mf">0.43</span>      <span class="o">-</span><span class="mf">0.24</span>       <span class="mf">2.82</span>      <span class="o">-</span><span class="mf">0.24</span>   <span class="o">-</span><span class="mf">0.18</span>  <span class="o">-</span><span class="mf">0.49</span>    <span class="mf">1.60</span>
<span class="n">AAACCTGCAAAGAATC</span><span class="o">-</span><span class="mi">1</span>       <span class="mf">2.24</span>   <span class="mf">0.82</span>  <span class="o">-</span><span class="mf">0.26</span>      <span class="o">-</span><span class="mf">0.28</span>  <span class="o">-</span><span class="mf">0.60</span>   <span class="o">-</span><span class="mf">0.51</span>    <span class="o">-</span><span class="mf">0.13</span> <span class="o">-</span><span class="mf">0.07</span>  <span class="o">-</span><span class="mf">0.29</span>      <span class="o">-</span><span class="mf">0.31</span> <span class="o">-</span><span class="mf">0.23</span>  <span class="o">-</span><span class="mf">0.31</span>  <span class="p">...</span>  <span class="o">-</span><span class="mf">0.25</span>  <span class="o">-</span><span class="mf">0.52</span>       <span class="mf">0.91</span>      <span class="o">-</span><span class="mf">0.55</span>      <span class="o">-</span><span class="mf">0.41</span>      <span class="o">-</span><span class="mf">0.43</span>      <span class="o">-</span><span class="mf">0.24</span>      <span class="o">-</span><span class="mf">0.43</span>      <span class="o">-</span><span class="mf">0.24</span>   <span class="o">-</span><span class="mf">0.18</span>  <span class="o">-</span><span class="mf">0.49</span>    <span class="mf">1.95</span>
<span class="n">AAACCTGCAAAGGAAG</span><span class="o">-</span><span class="mi">1</span>      <span class="o">-</span><span class="mf">0.22</span>  <span class="o">-</span><span class="mf">0.51</span>  <span class="o">-</span><span class="mf">0.26</span>      <span class="o">-</span><span class="mf">0.28</span>  <span class="o">-</span><span class="mf">0.60</span>   <span class="o">-</span><span class="mf">0.51</span>    <span class="o">-</span><span class="mf">0.13</span> <span class="o">-</span><span class="mf">0.07</span>  <span class="o">-</span><span class="mf">0.29</span>      <span class="o">-</span><span class="mf">0.31</span> <span class="o">-</span><span class="mf">0.23</span>  <span class="o">-</span><span class="mf">0.31</span>  <span class="p">...</span>   <span class="mf">3.51</span>  <span class="o">-</span><span class="mf">0.52</span>      <span class="o">-</span><span class="mf">0.48</span>       <span class="mf">1.85</span>      <span class="o">-</span><span class="mf">0.41</span>      <span class="o">-</span><span class="mf">0.43</span>      <span class="o">-</span><span class="mf">0.24</span>      <span class="o">-</span><span class="mf">0.43</span>       <span class="mf">8.85</span>   <span class="o">-</span><span class="mf">0.18</span>  <span class="o">-</span><span class="mf">0.49</span>    <span class="mf">0.16</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">dft</span><span class="p">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">4406</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>

<span class="c1"># as we have large number variables, we will first do to PCA to keep minimum number 
# of variables for t-SNE
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pca_scores</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">().</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">dft</span><span class="p">)</span>
<span class="c1"># create a dataframe of pca_scores
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">df_pc</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca_scores</span><span class="p">)</span>

<span class="c1"># perform t-SNE on PCs scores
# we will use first 50 PCs but this can vary
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tsne_em</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">early_exaggeration</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mi">368</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_pc</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">49</span><span class="p">])</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computing</span> <span class="mi">91</span> <span class="n">nearest</span> <span class="n">neighbors</span><span class="p">...</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Indexed</span> <span class="mi">4406</span> <span class="n">samples</span> <span class="ow">in</span> <span class="mf">0.081</span><span class="n">s</span><span class="p">...</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computed</span> <span class="n">neighbors</span> <span class="k">for</span> <span class="mi">4406</span> <span class="n">samples</span> <span class="ow">in</span> <span class="mf">1.451</span><span class="n">s</span><span class="p">...</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computed</span> <span class="n">conditional</span> <span class="n">probabilities</span> <span class="k">for</span> <span class="n">sample</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">4406</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computed</span> <span class="n">conditional</span> <span class="n">probabilities</span> <span class="k">for</span> <span class="n">sample</span> <span class="mi">2000</span> <span class="o">/</span> <span class="mi">4406</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computed</span> <span class="n">conditional</span> <span class="n">probabilities</span> <span class="k">for</span> <span class="n">sample</span> <span class="mi">3000</span> <span class="o">/</span> <span class="mi">4406</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computed</span> <span class="n">conditional</span> <span class="n">probabilities</span> <span class="k">for</span> <span class="n">sample</span> <span class="mi">4000</span> <span class="o">/</span> <span class="mi">4406</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Computed</span> <span class="n">conditional</span> <span class="n">probabilities</span> <span class="k">for</span> <span class="n">sample</span> <span class="mi">4406</span> <span class="o">/</span> <span class="mi">4406</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">Mean</span> <span class="n">sigma</span><span class="p">:</span> <span class="mf">4.812347</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">KL</span> <span class="n">divergence</span> <span class="n">after</span> <span class="mi">250</span> <span class="n">iterations</span> <span class="k">with</span> <span class="n">early</span> <span class="n">exaggeration</span><span class="p">:</span> <span class="mf">64.164688</span>
<span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">SNE</span><span class="p">]</span> <span class="n">KL</span> <span class="n">divergence</span> <span class="n">after</span> <span class="mi">1000</span> <span class="n">iterations</span><span class="p">:</span> <span class="mf">0.840337</span>
<span class="c1"># here you can run TSNE multiple times to keep run with lowest KL divergence
</span>
<span class="c1"># plot t-SNE clusters
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">bioinfokit.visuz</span> <span class="kn">import</span> <span class="n">cluster</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cluster</span><span class="p">.</span><span class="n">tsneplot</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">tsne_em</span><span class="p">)</span>
<span class="c1"># plot will be saved in same directory (tsne_2d.png) 
</span></code></pre></div></div>
<p>Generated t-SNE plot,</p>
<p align="center">
<img src="/assets/posts/tsne/tsne_2d_sc.svg" width="600" />
</p>

<p>Now, I will recognize the clusters using the DBSCAN algorithm. This will help to color and visualize clusters of similar
data points</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span>
<span class="c1"># here eps parameter is very important and optimizing eps is essential
# for well defined clusters. I have run DBSCAN with several eps values
# and got good clusters with eps=3
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">get_clusters</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">).</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">tsne_em</span><span class="p">)</span>
<span class="c1"># check unique clusters
# -1 value represents noisy points could not assigned to any cluster
</span><span class="o">&gt;&gt;&gt;</span> <span class="nb">set</span><span class="p">(</span><span class="n">get_clusters</span><span class="p">)</span>
<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="c1"># get t-SNE plot with colors assigned to each cluster
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">cluster</span><span class="p">.</span><span class="n">tsneplot</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">tsne_em</span><span class="p">,</span> <span class="n">colorlist</span><span class="o">=</span><span class="n">get_clusters</span><span class="p">,</span> 
    <span class="n">colordot</span><span class="o">=</span><span class="p">(</span><span class="s">'#713e5a'</span><span class="p">,</span> <span class="s">'#63a375'</span><span class="p">,</span> <span class="s">'#edc79b'</span><span class="p">,</span> <span class="s">'#d57a66'</span><span class="p">,</span> <span class="s">'#ca6680'</span><span class="p">,</span> <span class="s">'#395B50'</span><span class="p">,</span> <span class="s">'#92AFD7'</span><span class="p">,</span> <span class="s">'#b0413e'</span><span class="p">,</span> <span class="s">'#4381c1'</span><span class="p">,</span> <span class="s">'#736ced'</span><span class="p">,</span> <span class="s">'#631a86'</span><span class="p">,</span> <span class="s">'#de541e'</span><span class="p">,</span> <span class="s">'#022b3a'</span><span class="p">,</span> <span class="s">'#000000'</span><span class="p">),</span> 
    <span class="n">legendpos</span><span class="o">=</span><span class="s">'upper right'</span><span class="p">,</span> <span class="n">legendanchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<p>Generated t-SNE plot,</p>
<p align="center">
<img src="/assets/posts/tsne/tsne_2d_sc1.svg" width="600" />
</p>

<h2 id="interpretation"><span style="color:#33a8ff">Interpretation</span></h2>
<ul>
  <li>The points within the individual clusters are highly similar to each other and in distant to points in other clusters. 
The same pattern likely holds in a high-dimensional original dataset. In the digits dataset, t-SNE separated clusters 
of each digit class. In the context of scRNA-seq, these clusters represent the cells types with similar 
transcriptional profiles.</li>
</ul>

<h2 id="recommendations-for-running-t-sne-and-hyperparameter-optimization"><span style="color:#33a8ff">Recommendations for running t-SNE and hyperparameter optimization</span></h2>
<ul>
  <li>t-SNE is a stochastic method and produces slightly different embeddings if run multiple times. These different results
could affect the numeric values on the axis but do  not affect the clustering of the points. Therefore, t-SNE can be
run several times to get the embeddings with the smallest Kullbackâ€“Leibler (KL) divergence. The run with the smallest 
KL could have the greatest variation.</li>
  <li>If the original high-dimensional dataset contains larger number variables ,
it is highly recommended first to reduce the variables to small numbers (e.g. 20 to 50) using another dimensionality
reduction technique (e.g. PCA) for t-SNE. It will help
to speed up the t-SNE computation time and suppresses the noisy data points. Additionally, you can also use other 
variants of t-SNE such as Fast Fourier Transform-accelerated Interpolation-based t-SNE (FIt-SNE) for larger datasets 
(Linderman et al., 2019).</li>
  <li>In t-SNE, a most important parameter called perplexity, which measures the effective number of neighbors, controls 
the trade-off between global high-dimensional and local low-dimensional space, and possible to produce a more defined 
structure of the clusters. The number of variables in the original high dimensional data determines the  perplexity 
parameter (standard range 10-100).</li>
  <li>While t-SNE is good in visualizing the well-separated clusters, most of the time  it fails to preserve the
global geometry of the data. Kobak et al., 2019 suggested keeping large perplexity parameter (n/100; where n is 
the number of cells) for preserving the global geometry.</li>
  <li>In addition to the perplexity parameter, other parameters such as the number of iterations, learning rate (set n/12 or 200 
whichever is greater), and early exaggeration factor can also affect the visualization and should be optimized for 
larger datasets (Kobak et al., 2019).</li>
</ul>

<h2 id="references"><span style="color:#33a8ff">References</span></h2>
<ul>
  <li>Maaten LV, Hinton G. Visualizing data using t-SNE. Journal of machine learning research. 2008;9(Nov):2579-605.</li>
  <li>Kobak D, Berens P. The art of using t-SNE for single-cell transcriptomics. Nature communications. 2019 Nov 28;10(1):1-4.</li>
  <li>Cieslak MC, Castelfranco AM, Roncalli V, Lenz PH, Hartline DK. t-Distributed Stochastic Neighbor Embedding (t-SNE): A tool
for eco-physiological transcriptomic analysis. Marine Genomics. 2019 Nov 26:100723.</li>
  <li>Rich-Griffin C, Stechemesser A, Finch J, Lucas E, Ott S, SchÃ¤fer P. Single-cell transcriptomics: a high-resolution
avenue for plant functional genomics. Trends in plant science. 2020 Feb 1;25(2):186-97.</li>
  <li>Devassy BM, George S. Dimensionality reduction and visualisation of hyperspectral ink data Using t-SNE. Forensic
Science International. 2020 Feb 12:110194.</li>
  <li>Linderman GC, Rachh M, Hoskins JG, Steinerberger S, Kluger Y. Fast interpolation-based t-SNE for improved visualization
of single-cell RNA-seq data. Nature methods. 2019 Mar;16(3):243-5.</li>
  <li>Butler A, Hoffman P, Smibert P, Papalexi E, Satija R. Integrating single-cell transcriptomic data across different 
conditions, technologies, and species. Nature biotechnology. 2018 May;36(5):411-20.</li>
  <li>Ryu KH, Huang L, Kang HM, Schiefelbein J. Single-cell RNA sequencing resolves molecular relationships among individual 
plant cells. Plant physiology. 2019 Apr 1;179(4):1444-56.</li>
  <li>C. Kaynak (1995) Methods of Combining Multiple Classifiers and Their Applications to Handwritten Digit Recognition, 
MSc Thesis, Institute of Graduate Studies in Science and Engineering, Bogazici University.</li>
</ul>

<p>
<strong style="color:#33a8ff">How to cite?</strong>
<br />
Renesh Bedre.(2020, July 29). reneshbedre/bioinfokit: Bioinformatics data analysis and visualization toolkit (Version v0.9). Zenodo.
<a href="http://doi.org/10.5281/zenodo.3965241" target="_blank">http://doi.org/10.5281/zenodo.3965241</a>
<br /><br />
<span style="color:#9e9696">If you have any questions, comments or recommendations, please email me at
<b>reneshbe@gmail.com</b></span>





<!-- Begin Mailchimp Signup Form -->

<!--
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
	/* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://github.us10.list-manage.com/subscribe/post?u=1c0202ed60d33515742eec50a&amp;id=b17e2351b6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Subscribe for new articles</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
-->

    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
<!--
<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_1c0202ed60d33515742eec50a_b17e2351b6" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
-->

<!--End mc_embed_signup-->
</p>

<p>
<!--

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<style>
    .share-box a {
  display: inline-block;
  -webkit-box-shadow: 0 0 1px #777;
  box-shadow: 0 0 1px #777;
  padding: 5px 12px;
  margin-right: 5px;
  margin-bottom: 5px;
  text-decoration: none; }
  .share-box a:hover {
    text-decoration: none;
    -webkit-transition: background-color 200ms linear;
    -ms-transition: background-color 200ms linear;
    transition: background-color 200ms linear; }

.f {
  color: #3b5998; }
  .f:hover {
    color: #fff;
    background-color: #3b5998; }

.t {
  color: #4099FF; }
  .t:hover {
    color: #fff;
    background-color: #4099FF; }

.g {
  color: #d34836; }
  .g:hover {
    color: #fff;
    background-color: #d34836; }

.r {
  color: #ff5700; }
  .r:hover {
    color: #fff;
    background-color: #ff5700; }

.l {
  color: #0077b5; }
  .l:hover {
    color: #fff;
    background-color: #0077b5; }

.e {
  color: #444444; }
  .e:hover {
    color: #fff;
    background-color: #444444; }
</style>

<div class="share-box">
<a class="f" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/blog/tsne.html" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fab fa-facebook-f"></i></a>

<a class="t" href="https://twitter.com/intent/tweet?text=&url=http://localhost:4000/blog/tsne.html" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fab fa-twitter"></i></a>

  <a class="g" href="https://plus.google.com/share?url=http://localhost:4000/blog/tsne.html" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fab fa-google-plus-square"></i></a>


<a class="r" href="http://www.reddit.com/submit?url=http://localhost:4000/blog/tsne.html" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" ><i class="fab fa-reddit"></i></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/blog/tsne.html" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fab fa-linkedin-in"></i></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/blog/tsne.html"><i class="fas fa-envelope-square"></i></a>
-->

  <!--
    <a href="https://twitter.com/renbedre?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @renbedre</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
-->

<!--
</div>

-->

</p>

<p><span style="color:#9e9696"><i> Last updated: June 22, 2020</i> </span></p>

<p>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/" target="_blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.
</p>
:ET